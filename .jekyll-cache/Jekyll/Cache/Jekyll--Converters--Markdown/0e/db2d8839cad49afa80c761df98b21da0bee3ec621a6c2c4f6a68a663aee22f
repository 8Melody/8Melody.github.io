I"<blockquote>
  <p>è®°å½•ES6ä¸­Promiseçš„ä½¿ç”¨ã€‚</p>
</blockquote>

<h1 id="es6çš„promiseå¯¹è±¡ä½¿ç”¨å°è®°">ES6çš„Promiseå¯¹è±¡ä½¿ç”¨å°è®°ã€‚</h1>

<p>åœ¨ä½¿ç”¨<a href="https://github.com/axios/axios">axios</a>ä¸­ï¼Œç»å¸¸çœ‹åˆ° <code class="highlighter-rouge">Promise</code> å¯¹è±¡ï¼Œæœ¬æ–‡åšä¸ªå°è®°å½•ã€‚</p>

<p><code class="highlighter-rouge">Promise</code> å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆçŠ¶æ€ï¼ˆå®Œæˆæˆ–å¤±è´¥ï¼‰ï¼Œä»¥åŠè¯¥å¼‚æ­¥æ“ä½œçš„ç»“æœå€¼ï¼Œæœ¬è´¨ä¸Šï¼Œ<code class="highlighter-rouge">Promise</code> æ˜¯ä¸€ä¸ªç»‘å®šäº†å›è°ƒçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å°†å›è°ƒä¼ è¿›å‡½æ•°å†…éƒ¨ã€‚</p>

<h2 id="è¯­æ³•">è¯­æ³•</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{...}</span> <span class="cm">/* executor */</span>  <span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚æ•°è¯´æ˜ï¼š
<code class="highlighter-rouge">executor</code> æ˜¯å¸¦æœ‰ <code class="highlighter-rouge">resolve</code> å’Œ <code class="highlighter-rouge">reject</code> ä¸¤ä¸ªå‚æ•°çš„å‡½æ•° ã€‚<code class="highlighter-rouge">Promise</code> æ„é€ å‡½æ•°æ‰§è¡Œæ—¶ç«‹å³è°ƒç”¨ <code class="highlighter-rouge">executor</code> å‡½æ•°ï¼Œ <code class="highlighter-rouge">resolve</code> å’Œ <code class="highlighter-rouge">reject</code> ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code class="highlighter-rouge">executor</code>ï¼ˆexecutor å‡½æ•°åœ¨ <code class="highlighter-rouge">Promise</code> æ„é€ å‡½æ•°è¿”å›æ‰€å»º <code class="highlighter-rouge">promise</code> å®ä¾‹å¯¹è±¡å‰è¢«è°ƒç”¨ï¼‰ã€‚<code class="highlighter-rouge">resolve</code> å’Œ <code class="highlighter-rouge">reject</code> å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œåˆ†åˆ«å°† <code class="highlighter-rouge">promise</code>çš„çŠ¶æ€æ”¹ä¸º<code class="highlighter-rouge">fulfilledï¼ˆå®Œæˆï¼‰</code>æˆ– <code class="highlighter-rouge">rejectedï¼ˆå¤±è´¥ï¼‰</code>ã€‚<code class="highlighter-rouge">executor</code> å†…éƒ¨é€šå¸¸ä¼šæ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä¸€æ—¦å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæ¯•(å¯èƒ½æˆåŠŸ/å¤±è´¥)ï¼Œè¦ä¹ˆè°ƒç”¨ <code class="highlighter-rouge">resolve</code> å‡½æ•°æ¥å°† <code class="highlighter-rouge">promise</code> çŠ¶æ€æ”¹æˆ <code class="highlighter-rouge">fulfilled</code>ï¼Œè¦ä¹ˆè°ƒç”¨ <code class="highlighter-rouge">reject</code> å‡½æ•°å°† <code class="highlighter-rouge">promise</code> çš„çŠ¶æ€æ”¹ä¸º <code class="highlighter-rouge">rejected</code>ã€‚å¦‚æœåœ¨ <code class="highlighter-rouge">executor</code> å‡½æ•°ä¸­æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆè¯¥ <code class="highlighter-rouge">promise</code> çŠ¶æ€ä¸º <code class="highlighter-rouge">rejected</code>ã€‚<code class="highlighter-rouge">executor</code> å‡½æ•°çš„è¿”å›å€¼è¢«å¿½ç•¥ã€‚</p>

<h2 id="å¸¸è§„ä½¿ç”¨æ–¹æ³•">å¸¸è§„ä½¿ç”¨æ–¹æ³•</h2>

<p><strong>resolve</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">pmise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">resolve</span><span class="p">(</span><span class="dl">"</span><span class="s2">delay completed</span><span class="dl">"</span><span class="p">);</span>
	<span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">pmise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åœ¨500msä¹‹åä¼šæ‰§è¡Œalert(â€œdeley compltedâ€)ã€‚</p>

<hr />

<p><strong>reject</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">pmise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">sorry, error occurred!</span><span class="dl">"</span><span class="p">);</span>
	<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">pmise</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">alert</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<hr />

<p><strong>catch</strong>
<code class="highlighter-rouge">catch</code> å¯ä»¥æŒ‡å®š <code class="highlighter-rouge">reject</code> çš„å›è°ƒï¼Œå®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªä½œç”¨ï¼šåœ¨æ‰§è¡Œ <code class="highlighter-rouge">resolve</code> çš„å›è°ƒï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢thenä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰æ—¶ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸äº†ï¼ˆä»£ç å‡ºé”™äº†ï¼‰ï¼Œé‚£ä¹ˆå¹¶ä¸ä¼šæŠ¥é”™å¡æ­»jsï¼Œè€Œæ˜¯ä¼šè¿›åˆ°è¿™ä¸ª<code class="highlighter-rouge">catch</code>æ–¹æ³•ä¸­ã€‚</p>

<hr />

<p><strong>finally</strong>
æ–¹æ³•è¿”å›ä¸€ä¸ª <code class="highlighter-rouge">Promise</code>ï¼Œåœ¨ <code class="highlighter-rouge">promise</code> æ‰§è¡Œç»“æŸæ—¶ï¼Œæ— è®ºç»“æœæ˜¯ <code class="highlighter-rouge">fulfilled</code> æˆ–è€…æ˜¯ <code class="highlighter-rouge">rejected</code>ï¼Œåœ¨æ‰§è¡Œ <code class="highlighter-rouge">then()</code> å’Œ <code class="highlighter-rouge">catch()</code> åï¼Œéƒ½ä¼šæ‰§è¡Œ <code class="highlighter-rouge">finally</code> æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ºæŒ‡å®šæ‰§è¡Œå®Œ <code class="highlighter-rouge">promise</code> åï¼Œæ— è®ºç»“æœæ˜¯ <code class="highlighter-rouge">fulfilled</code> è¿˜æ˜¯ <code class="highlighter-rouge">rejected</code> éƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œé¿å…åŒæ ·çš„è¯­å¥éœ€è¦åœ¨ <code class="highlighter-rouge">then()</code> å’Œ <code class="highlighter-rouge">catch()</code> ä¸­å„å†™ä¸€æ¬¡çš„æƒ…å†µã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">pmise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">sorry, error occurred!</span><span class="dl">"</span><span class="p">);</span>
	<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">pmise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">xxx</span><span class="p">)</span>
     <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">xxx</span><span class="p">)</span>
     <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="c1">//å–æ¶ˆè¿›åº¦æ¡ç­‰</span>
     <span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="æè¿°">æè¿°</h2>

<p><code class="highlighter-rouge">Promise</code> å¯¹è±¡æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆä»£ç†ä¸€ä¸ªå€¼ï¼‰ï¼Œè¢«ä»£ç†çš„å€¼åœ¨ <code class="highlighter-rouge">Promise</code> å¯¹è±¡åˆ›å»ºæ—¶å¯èƒ½æ˜¯æœªçŸ¥çš„ã€‚å®ƒå…è®¸ä½ ä¸ºå¼‚æ­¥æ“ä½œçš„æˆåŠŸå’Œå¤±è´¥åˆ†åˆ«ç»‘å®šç›¸åº”çš„å¤„ç†æ–¹æ³•ï¼ˆhandlersï¼‰ã€‚ è¿™è®©å¼‚æ­¥æ–¹æ³•å¯ä»¥åƒåŒæ­¥æ–¹æ³•é‚£æ ·è¿”å›å€¼ï¼Œä½†å¹¶ä¸æ˜¯ç«‹å³è¿”å›æœ€ç»ˆæ‰§è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä»£è¡¨æœªæ¥å‡ºç°çš„ç»“æœçš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡ã€‚</p>

<p>ä¸€ä¸ª<code class="highlighter-rouge">Promise</code>æœ‰å‡ ä¸ªçŠ¶æ€ï¼š</p>

<ul>
  <li>pendingï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸä¹Ÿä¸æ˜¯å¤±è´¥ã€‚</li>
  <li>fulfilledï¼šæ„å‘³ç€æ“ä½œæˆåŠŸã€‚</li>
  <li>rejectedï¼šæ„å‘³ç€æ“ä½œå¤±è´¥ã€‚</li>
</ul>

<p><code class="highlighter-rouge">pending</code> çŠ¶æ€çš„ <code class="highlighter-rouge">Promise</code> å¯¹è±¡å¯èƒ½ä¼šå˜ä¸º <code class="highlighter-rouge">fulfilled</code> çŠ¶æ€å¹¶ä¼ é€’ä¸€ä¸ªå€¼ç»™ç›¸åº”çš„çŠ¶æ€å¤„ç†æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½å˜ä¸ºå¤±è´¥çŠ¶æ€ï¼ˆ<code class="highlighter-rouge">rejected</code>ï¼‰å¹¶ä¼ é€’å¤±è´¥ä¿¡æ¯ã€‚å½“å…¶ä¸­ä»»ä¸€ç§æƒ…å†µå‡ºç°æ—¶ï¼Œ<code class="highlighter-rouge">Promise</code> å¯¹è±¡çš„ <code class="highlighter-rouge">then</code> æ–¹æ³•ç»‘å®šçš„å¤„ç†æ–¹æ³•ï¼ˆhandlers ï¼‰å°±ä¼šè¢«è°ƒç”¨ï¼ˆ<code class="highlighter-rouge">then</code>æ–¹æ³•åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š<code class="highlighter-rouge">onfulfilled</code> å’Œ <code class="highlighter-rouge">onrejected</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ <code class="highlighter-rouge">Function</code> ç±»å‹ã€‚å½“ <code class="highlighter-rouge">Promise</code> çŠ¶æ€ä¸º <code class="highlighter-rouge">fulfilled</code> æ—¶ï¼Œè°ƒç”¨ <code class="highlighter-rouge">then</code> çš„ <code class="highlighter-rouge">onfulfilled</code> æ–¹æ³•ï¼Œå½“ <code class="highlighter-rouge">Promise</code> çŠ¶æ€ä¸º <code class="highlighter-rouge">rejected</code> æ—¶ï¼Œè°ƒç”¨ <code class="highlighter-rouge">then</code> çš„ <code class="highlighter-rouge">onrejected</code> æ–¹æ³•ï¼Œ æ‰€ä»¥åœ¨å¼‚æ­¥æ“ä½œçš„å®Œæˆå’Œç»‘å®šå¤„ç†æ–¹æ³•ä¹‹é—´ä¸å­˜åœ¨ç«äº‰ï¼‰ã€‚</p>

<h2 id="åˆ›å»ºpromise">åˆ›å»ºPromise</h2>

<p><code class="highlighter-rouge">Promise</code> å¯¹è±¡æ˜¯ç”±å…³é”®å­— <code class="highlighter-rouge">new</code> åŠå…¶æ„é€ å‡½æ•°æ¥åˆ›å»ºçš„ã€‚è¯¥æ„é€ å‡½æ•°ä¼šæŠŠä¸€ä¸ªå«åš <code class="highlighter-rouge">â€œå¤„ç†å™¨å‡½æ•°â€ï¼ˆexecutor functionï¼‰</code>çš„å‡½æ•°ä½œä¸ºå®ƒçš„å‚æ•°ã€‚è¿™ä¸ªâ€œå¤„ç†å™¨å‡½æ•°â€æ¥å—ä¸¤ä¸ªå‡½æ•°â€”â€” <code class="highlighter-rouge">resolve</code> å’Œ <code class="highlighter-rouge">reject</code> â€”â€”ä½œä¸ºå…¶å‚æ•°ã€‚å½“å¼‚æ­¥ä»»åŠ¡é¡ºåˆ©å®Œæˆä¸”è¿”å›ç»“æœå€¼æ—¶ï¼Œä¼šè°ƒç”¨ <code class="highlighter-rouge">resolve</code> å‡½æ•°ï¼›è€Œå½“å¼‚æ­¥ä»»åŠ¡å¤±è´¥ä¸”è¿”å›å¤±è´¥åŸå› ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼‰æ—¶ï¼Œä¼šè°ƒç”¨ <code class="highlighter-rouge">reject</code> å‡½æ•°ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">pmise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="c1">// ?åšä¸€äº›å¼‚æ­¥æ“ä½œï¼Œæœ€ç»ˆä¼šè°ƒç”¨ä¸‹é¢ä¸¤è€…ä¹‹ä¸€:</span>
	<span class="c1">//</span>
	<span class="c1">//   resolve(someValue); // fulfilled</span>
	<span class="c1">// ?æˆ–</span>
	<span class="c1">//   reject("failure reason"); // rejected</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç»“åˆå…¶ä»–å‡½æ•°ä½¿ç”¨ï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nx">simplePromise</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">cost</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
		<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">xxx</span><span class="dl">"</span><span class="p">);</span>
		<span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
		<span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
		<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
	<span class="p">})</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="é“¾å¼è°ƒç”¨">é“¾å¼è°ƒç”¨</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="nx">clickBtn</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">asyncA</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">obj</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">alert</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">asyncB</span><span class="p">();</span>
	<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">obj</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">alert</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
	<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">reason</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">alert</span><span class="p">(</span><span class="nx">reason</span><span class="p">);</span>
	<span class="p">})</span>
<span class="p">},</span>
<span class="nx">asyncA</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">res</span><span class="p">,</span> <span class="nx">rej</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="nx">res</span><span class="p">(</span><span class="dl">"</span><span class="s2">asyncA completed</span><span class="dl">"</span><span class="p">);</span>
		<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">},</span>
<span class="nx">asyncB</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">res</span><span class="p">,</span> <span class="nx">rej</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
			<span class="nx">res</span><span class="p">(</span><span class="dl">"</span><span class="s2">asyncB completed</span><span class="dl">"</span><span class="p">);</span>
		<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="promisealliterable">Promise.all(iterable)</h2>

<p>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡ï¼Œè¯¥ <code class="highlighter-rouge">promise</code> å¯¹è±¡åœ¨ <code class="highlighter-rouge">iterable</code> å‚æ•°å¯¹è±¡é‡Œæ‰€æœ‰çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡éƒ½æˆåŠŸçš„æ—¶å€™æ‰ä¼šè§¦å‘æˆåŠŸï¼Œä¸€æ—¦æœ‰ä»»ä½•ä¸€ä¸ª <code class="highlighter-rouge">iterable</code> é‡Œé¢çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡å¤±è´¥åˆ™ç«‹å³è§¦å‘è¯¥ <code class="highlighter-rouge">promise</code> å¯¹è±¡çš„å¤±è´¥ã€‚è¿™ä¸ªæ–°çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡åœ¨è§¦å‘æˆåŠŸçŠ¶æ€ä»¥åï¼Œä¼šæŠŠä¸€ä¸ªåŒ…å« <code class="highlighter-rouge">iterable</code> é‡Œæ‰€æœ‰ <code class="highlighter-rouge">promise</code> è¿”å›å€¼çš„æ•°ç»„ä½œä¸ºæˆåŠŸå›è°ƒçš„è¿”å›å€¼ï¼Œé¡ºåºè·Ÿ <code class="highlighter-rouge">iterable</code> çš„é¡ºåºä¿æŒä¸€è‡´ï¼›å¦‚æœè¿™ä¸ªæ–°çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡è§¦å‘äº†å¤±è´¥çŠ¶æ€ï¼Œå®ƒä¼šæŠŠ <code class="highlighter-rouge">iterable</code> é‡Œç¬¬ä¸€ä¸ªè§¦å‘å¤±è´¥çš„ <code class="highlighter-rouge">promise</code> å¯¹è±¡çš„é”™è¯¯ä¿¡æ¯ä½œä¸ºå®ƒçš„å¤±è´¥é”™è¯¯ä¿¡æ¯ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/javascript/Reference/Global_Objects/Promise/all">Promise.all</a> æ–¹æ³•å¸¸è¢«ç”¨äºå¤„ç†å¤šä¸ª <code class="highlighter-rouge">promise</code> å¯¹è±¡çš„çŠ¶æ€é›†åˆã€‚</p>

<p>æ­¤å®ä¾‹åœ¨ <code class="highlighter-rouge">iterable</code> å‚æ•°å†…æ‰€æœ‰çš„ <code class="highlighter-rouge">promise</code> éƒ½â€œ <code class="highlighter-rouge">å®Œæˆï¼ˆresolvedï¼‰</code>â€æˆ–å‚æ•°ä¸­ä¸åŒ…å« <code class="highlighter-rouge">promise</code> æ—¶å›è°ƒå®Œæˆï¼ˆ<code class="highlighter-rouge">resolve</code>ï¼‰ï¼›å¦‚æœå‚æ•°ä¸­ <code class="highlighter-rouge">promise</code> æœ‰ä¸€ä¸ªå¤±è´¥ï¼ˆ<code class="highlighter-rouge">rejected</code>ï¼‰ï¼Œæ­¤å®ä¾‹å›è°ƒå¤±è´¥ï¼ˆ<code class="highlighter-rouge">reject</code>ï¼‰ï¼Œå¤±è´¥åŸå› çš„æ˜¯ç¬¬ä¸€ä¸ªå¤±è´¥ <code class="highlighter-rouge">promise</code> çš„ç»“æœã€‚</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">promise1</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">promise2</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">promise3</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">promise1</span><span class="p">,</span> <span class="nx">promise2</span><span class="p">,</span> <span class="nx">promise3</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="nx">values</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>è¾“å‡ºï¼š</p>

<blockquote>
  <p>Array [3, 42, â€œfooâ€]</p>
</blockquote>

<h2 id="promiseraceiterable">Promise.race(iterable)</h2>

<p>å½“ <code class="highlighter-rouge">iterable</code> å‚æ•°é‡Œçš„ä»»æ„ä¸€ä¸ªå­ <code class="highlighter-rouge">promise</code> è¢«æˆåŠŸæˆ–å¤±è´¥åï¼Œçˆ¶ <code class="highlighter-rouge">promise</code> é©¬ä¸Šä¹Ÿä¼šç”¨å­ <code class="highlighter-rouge">promise</code> çš„æˆåŠŸè¿”å›å€¼æˆ–å¤±è´¥è¯¦æƒ…ä½œä¸ºå‚æ•°è°ƒç”¨çˆ¶ <code class="highlighter-rouge">promise</code> ç»‘å®šçš„ç›¸åº”å¥æŸ„ï¼Œå¹¶è¿”å›è¯¥ <code class="highlighter-rouge">promise</code> å¯¹è±¡ã€‚</p>

<p>å¯ä»¥ç†è§£ä¸ºä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ª <code class="highlighter-rouge">promise</code> è§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„  <code class="highlighter-rouge">promise</code> å°±ä¼šè§£å†³æˆ–æ‹’ç»ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">promise1</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">promise2</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="dl">'</span><span class="s1">two</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">race</span><span class="p">([</span><span class="nx">promise1</span><span class="p">,</span> <span class="nx">promise2</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
  <span class="c1">// Both resolve, but promise2 is faster</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä¸Šé¢åªä¼šè¾“å‡ºï¼š</p>

<blockquote>
  <p>two</p>
</blockquote>

<h2 id="promiseresolvevalue">Promise.resolve(value)</h2>

<p>è¿”å›ä¸€ä¸ªä»¥ç»™å®šå€¼è§£æåçš„ <code class="highlighter-rouge">Promise</code> å¯¹è±¡ã€‚ä½†å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸ª <code class="highlighter-rouge">thenableï¼ˆå³å¸¦æœ‰thenæ–¹æ³•ï¼‰</code>ï¼Œè¿”å›çš„ <code class="highlighter-rouge">promise</code> ä¼šâ€œè·Ÿéšâ€è¿™ä¸ª <code class="highlighter-rouge">thenable</code> çš„å¯¹è±¡ï¼Œé‡‡ç”¨å®ƒçš„æœ€ç»ˆçŠ¶æ€ï¼ˆæŒ‡<code class="highlighter-rouge">resolved</code>/<code class="highlighter-rouge">rejected</code>/<code class="highlighter-rouge">pending</code>/<code class="highlighter-rouge">settled</code>ï¼‰ï¼›å¦‚æœä¼ å…¥çš„ <code class="highlighter-rouge">value</code> æœ¬èº«å°±æ˜¯ <code class="highlighter-rouge">promise</code> å¯¹è±¡ï¼Œåˆ™è¯¥å¯¹è±¡ä½œä¸º <code class="highlighter-rouge">Promise.resolve</code> æ–¹æ³•çš„è¿”å›å€¼è¿”å›ï¼›å¦åˆ™ä»¥è¯¥å€¼ä¸ºæˆåŠŸçŠ¶æ€è¿”å› <code class="highlighter-rouge">promise</code> å¯¹è±¡ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">promise1</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>

<span class="nx">promise1</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">"</span><span class="s2">Success</span><span class="dl">"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">value</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// "Success"</span>
<span class="p">},</span> <span class="nx">reason</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ä¸ä¼šè¢«è°ƒç”¨</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">v</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// 1</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="resolveå¦ä¸€ä¸ªpromiseå¯¹è±¡">Resolveå¦ä¸€ä¸ªpromiseå¯¹è±¡</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">original</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">æˆ‘åœ¨ç¬¬äºŒè¡Œ</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cast</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">original</span><span class="p">);</span>
<span class="nx">cast</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">original === cast ? </span><span class="dl">'</span> <span class="o">+</span> <span class="p">(</span><span class="nx">original</span> <span class="o">===</span> <span class="nx">cast</span><span class="p">));</span>

<span class="cm">/*
*  æ‰“å°é¡ºåºå¦‚ä¸‹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªåŒæ­¥å¼‚æ­¥å…ˆåæ‰§è¡Œçš„åŒºåˆ«
*  original === cast ? true
*  value: æˆ‘åœ¨ç¬¬äºŒè¡Œ
*/</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="promiserejectreason">Promise.reject(reason)</h2>

<p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¸¦æœ‰æ‹’ç»åŸå›  <code class="highlighter-rouge">reason</code> å‚æ•°çš„ <code class="highlighter-rouge">Promise</code> å¯¹è±¡ã€‚</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">fail</span><span class="dl">"</span><span class="p">)).</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// æœªè¢«è°ƒç”¨</span>
<span class="p">},</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span> <span class="c1">// stacktrace</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¯¦ç»†è¯´æ˜å‚è§<a href="https://developer.mozilla.org/zh-CN/docs/Web/javascript/Reference/Global_Objects/Promise">Promise</a>ã€‚</p>
:ET